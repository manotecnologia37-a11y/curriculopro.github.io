
import React, { useState } from 'react';
import { parseResumeData } from '../../services/geminiService';

interface Props {
  onDataParsed: (data: any) => void;
}

const AutoFillForm: React.FC<Props> = ({ onDataParsed }) => {
  const [text, setText] = useState('');
  const [loading, setLoading] = useState(false);

  const handleAutoFill = async () => {
    if (!text.trim()) {
      alert("Por favor, cole algum texto antes de continuar.");
      return;
    }
    setLoading(true);
    try {
      const result = await parseResumeData(text);
      if (result) {
        onDataParsed(result);
        setText('');
      } else {
        alert("Não foi possível processar o texto. Tente novamente.");
      }
    } catch (err) {
      alert("Erro ao conectar com a IA.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="space-y-6 animate-fadeIn">
      <div className="bg-indigo-600 p-6 rounded-2xl text-white shadow-lg shadow-indigo-100 mb-8">
        <div className="flex items-center gap-4 mb-3">
          <div className="bg-white/20 p-3 rounded-xl backdrop-blur-sm">
            <i className="fas fa-wand-magic-sparkles text-2xl"></i>
          </div>
          <div>
            <h3 className="text-xl font-bold">Preenchimento Mágico</h3>
            <p className="text-indigo-100 text-sm">Cole seu histórico e deixe a IA trabalhar por você.</p>
          </div>
        </div>
        <p className="text-xs text-indigo-200 leading-relaxed italic">
          "Você pode colar seu currículo antigo, perfil do LinkedIn ou apenas listar suas experiências em um texto informal."
        </p>
      </div>

      <div className="space-y-4">
        <label className="block text-xs font-black text-slate-500 uppercase tracking-widest">Texto Base para o Currículo</label>
        <textarea
          value={text}
          onChange={(e) => setText(e.target.value)}
          placeholder="Ex: Sou Alexandra, trabalhei 5 anos como Recepcionista na empresa X, sou formada em Pedagogia pela Unopar..."
          rows={12}
          className="w-full px-4 py-4 border-2 border-slate-100 rounded-2xl focus:border-indigo-500 focus:ring-0 outline-none transition-all resize-none text-slate-700 leading-relaxed font-medium bg-slate-50/50"
        />
        
        <button
          onClick={handleAutoFill}
          disabled={loading}
          className={`w-full py-4 rounded-xl font-bold uppercase tracking-widest text-sm flex items-center justify-center gap-3 transition-all shadow-xl hover:shadow-indigo-200 ${
            loading 
              ? 'bg-slate-200 text-slate-400 cursor-not-allowed' 
              : 'bg-indigo-600 text-white hover:bg-indigo-700 active:scale-[0.98]'
          }`}
        >
          {loading ? (
            <>
              <i className="fas fa-circle-notch fa-spin"></i>
              Processando Informações...
            </>
          ) : (
            <>
              <i className="fas fa-bolt"></i>
              Preencher Currículo Agora
            </>
          )}
        </button>
      </div>

      <div className="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-xl">
        <div className="flex gap-3">
          <i className="fas fa-exclamation-triangle text-amber-400 mt-1"></i>
          <div>
            <p className="text-sm font-bold text-amber-800">Importante</p>
            <p className="text-xs text-amber-700 mt-1 leading-relaxed">
              O preenchimento automático substitui as informações atuais. Revise os campos após o processamento para garantir a precisão.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

export default AutoFillForm;
